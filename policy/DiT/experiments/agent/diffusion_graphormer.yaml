# Copyright (c) Sudeep Dasari, 2023

# This source code is licensed under the MIT license found in the
# LICENSE file in the root directory of this source tree.


defaults:
  - features: resnet_gn_nopool
  - _self_

_target_: data4robotics.models.diffusion_graphormer.DiffusionGraphormerAgent
odim: ${task.obs_dim}
n_cams: ${task.n_cams}
use_obs: add_token
dropout: 0.1
train_diffusion_steps: 100
eval_diffusion_steps: 8
ac_dim: ${task.ac_dim}
ac_chunk: ${ac_chunk}
imgs_per_cam: ${add:${img_chunk},${len:${task.train_buffer.goal_indexes}}}
share_cam_features: False
early_fusion: False
feat_norm: null

graphormer_kwargs:
  max_degree: ${task.ac_dim}
  max_spatial: ${task.ac_dim}
  embodiment_adjacency_matrix: [
      [0, 1, 0, 0, 0, 0, 0],
      [1, 0, 1, 0, 0, 0, 0],
      [0, 1, 0, 1, 0, 0, 0],
      [0, 0, 1, 0, 1, 0, 0],
      [0, 0, 0, 1, 0, 1, 0],
      [0, 0, 0, 0, 1, 0, 1],
      [0, 0, 0, 0, 0, 1, 0]
  ]  # TODO: replace with actual adjacency matrix
  embodiment_degree_matrix: [7, 2, 3, 3, 3, 3, 3, 2]
  embodiment_shortest_path_matrix: [
      [0, 1, 1, 1, 1, 1, 1, 1],
      [1, 0, 1, 2, 3, 4, 5, 6],
      [1, 1, 0, 1, 2, 3, 4, 5],
      [1, 2, 1, 0, 1, 2, 3, 4],
      [1, 3, 2, 1, 0, 1, 2, 3],
      [1, 4, 3, 2, 1, 0, 1, 2],
      [1, 5, 4, 3, 2, 1, 0, 1],
      [1, 6, 5, 4, 3, 2, 1, 0]
    ]

noise_net_kwargs:
  time_dim: 256
  hidden_dim: 512
  num_blocks: 6
  dim_feedforward: 2048
  dropout: ${agent.dropout}
  nhead: 8
  activation: "gelu"
